# Vibe Pong AI - Lessons Learned

This document records key insights, troubleshooting steps, and decisions made during the development of Vibe Pong AI.

## Vercel Deployment Troubleshooting (V0.1)

**Problem:** Initial deployment resulted in a black screen on the Vercel URL, despite working correctly on the local development server (`webpack serve`). Build logs showed success but potentially very large bundle sizes.

**Key Findings & Solutions:**

1.  **Bundle Size (Phaser):**
    *   **Finding:** The default Webpack build bundled the entire Phaser library, resulting in an excessively large `bundle.js` (~13.5 MB), causing performance issues (slow load/execution) even without explicit errors.
    *   **Solution:** Configured Phaser as an external library (`externals: { phaser: 'Phaser' }` in `webpack.config.js`) and loaded it via a CDN `<script>` tag in `index.html`. This drastically reduced `bundle.js` size (~30 KB).

2.  **Script Load Order (CDN vs. Bundle):**
    *   **Finding:** Placing the Phaser CDN script in `<head>` and relying on default Webpack injection of `bundle.js` at the end of `<body>` created a potential race condition where `bundle.js` might execute before the global `Phaser` object was defined by the CDN script.
    *   **Solution:** Moved the Phaser CDN `<script>` tag to the end of `<body>`, placed *before* where `bundle.js` is injected. Removed the `DOMContentLoaded` listener in `src/index.ts` and called `initGame()` directly, ensuring Phaser is loaded first.

3.  **Webpack Production Mode:**
    *   **Finding:** `webpack.config.js` had `mode: 'development'` hardcoded, potentially overriding the `--mode=production` flag used by the `npm run build` script on Vercel.
    *   **Solution:** Removed the hardcoded `mode` from `webpack.config.js`, allowing the command-line flag to control the build mode correctly.

4.  **Vercel Output Directory / `HtmlWebpackPlugin` Processing:**
    *   **Finding:** Vercel was apparently serving the raw `public/index.html` template instead of the processed version from the `dist` directory generated by Webpack. Evidence included unprocessed title variable (`<%= ... %>`) and missing `<script src="bundle.js">` tag in the served HTML source.
    *   **Solution:** Created a `vercel.json` file in the project root specifying `"outputDirectory": "dist"`. This explicitly tells Vercel to serve content from the Webpack build output directory, ensuring the processed `index.html` (with injected scripts) is used.
    *   *(Note: As part of debugging this, we also simplified `HtmlWebpackPlugin` config by removing the `title` option and hardcoding the title in `index.html`, and removed the `inject: 'body'` option, relying on defaults. These simplifications were kept but the root cause was likely the missing `vercel.json` config).* 

5.  **TypeScript Configuration (`tsconfig.json`):**
    *   **Finding:** `outDir: "./dist"` was specified, which is unnecessary when using Webpack/`ts-loader` to handle bundling and output.
    *   **Solution:** Removed the `outDir` setting to avoid potential confusion.

--- 